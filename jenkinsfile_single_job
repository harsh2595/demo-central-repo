pipeline {
  agent any

  stages {
    stage ("Build the maven war package") {
      steps {
        node ("build_server") {

          //checkout the SCM
          print ("downloading the source code from github")

          checkout scmGit(
            branches: [[name: '*/maven-brnach']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/harsh2595/demo-central-repo.git']]
          )

          //delete and create a new war package
          print ("Deleting the old maven package")
          print ("creating new maven package")
          sh "mvn clean install"

          // stash the war package
          print ("preparing war package to copy to the deploy server")
          stash( includes: "target/hello-world-webapp.war", name: "package-maven")
        }
      }
    }

    stage ("deploy the maven package") {
      steps {
        node ("deploy_server") {
          //delete the old maven package
          print ("deleting the old maven package")
          sh "rm -rf //home/ubuntu/tomcat/webapps/hello-world-webapp.war"

          //unstash the maven package
          print ("setting the directory to webapps"
          dir ("home/ubuntu/tomcat/webapps") {
            print ("getting  the package from the build_server")
            unstash (name: "package-maven")
         }
       }
     }
    }
  }
}
